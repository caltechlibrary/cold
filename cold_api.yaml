#
# cold_public.yaml defines the controlled object list and datum application's
# Public JSON API and static content service. It is run via datasetd.
#
# @author: R. S. Doiel <rsdoiel@caltech.edu>
#
host: localhost:8085
# This htdocs directory is provided by admin so we don't enable it.
htdocs: htdocs
collections:
  # Each collection is an object. The path prefix is
  # /api/<dataset_name>/...
  - dataset: admin/people.ds
    query:
      people_names: select json_object('clpid', src->'clpid', 'family_name', src->'family_name', 'given_name', src->'given_name') as src from people order by src->'family_name' ASC, src->'given_name' ASC;
    # What follows are object level permissions
    keys: true
    read: true
  - dataset: admin/groups.ds
    query:
      group_names: select json_object('clgid', src->'clgid', 'group_name', src->'name') as src from groups order by src->'name' ASC;
    # What follows are object level permissions
    keys: true
    read: true
  - dataset: admin/funders.ds
    query:
      funder_names: select json_object('clfid', src->'clfid', 'funder_name', src->'name') as src from funders order by src->'name' ASC;
    # What follows are object level permissions
    keys: true
    read: true
  - dataset: admin/subjects.ds
    query:
      subject_names: select json_object('clsid', src->'clsid', 'subject_name', src->'name') as src from subjects order by src->'name' ASC;
    # What follows are object level permissions
    keys: true
    read: true
  - dataset: admin/issn.ds
    query:
      issn_names: select json_object('issn', src->'issn', 'issn_name', src->'name') as src from issn order by src->'name' ASC;
    # What follows are object level permissions
    keys: true
    read: true
  - dataset: admin/doi_prefix.ds
    query:
      doi_prefix_names: select json_object('doi_prefix', src->'doi_prefix', 'doi_prefix', src->'name') as src from doi_prefix order by src->'name' ASC;
    # What follows are object level permissions
    keys: true
    read: true
