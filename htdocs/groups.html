<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Caltech Library's Digital Library Development Sandbox</title>
    <link rel="stylesheet" href="/css/site.css">
</head>
<body>
<header>
<a href="http://library.caltech.edu"><img src="/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
<li>
<a href="/app/">Home</a>
</li>
<li>
<a href="/app/dashboard.html">Dashboard</a>
</li>
<li>
<a href="/api/version">Version</a>
</li>
</ul>
</nav>

<section>
<h1>
Groups
</h1>
<p>
This page provides a widget demonstrating display and editing options
for group web components.
</p>
<h2>
Display
</h2>
<div>
<button id="group-refresh-button">
Refresh Group List
</button>
<button id="group-add-button">Add Group</button>
</div>
<p>
<div id="group-manager">
<!-- this is where a form appears to work with our group data -->
</div>
<div id="group-list">
Fetch group data and display here
</div>
<script type="module" src="/widgets/groups.js"></script>
<script type="module">
"use strict";
import { Group } from '/widgets/groups.js';

let group_add_button = document.getElementById('group-add-button'),
    group_refresh_button = document.getElementById('group-refresh-button'),
    group_manager = document.getElementById('group-manager'),
    group_list = document.getElementById('group-list'),
    u = window.location;

function updateGroupElement(key, elem) {
    let oReq = new XMLHttpRequest(),
        api_path = `/api/group/${key}`;
    oReq.addEventListener('load', function () {
        let src = this.responseText,
            obj = JSON.parse(src);
        elem.value = obj;
        elem.showElement();
    });
    oReq.open('GET', api_path);
    oReq.send();
}

function updateGroupsList() {
    /* Iterate through the fetched data, generate a group-display element
       and link to form for editing group data */
    let src = this.responseText,
            keys = JSON.parse(src);

    keys.sort();
    let i = 0;
    for (const key of keys) {
        let group_display = document.createElement('group-display');
        updateGroupElement(key, group_display);
        group_list.appendChild(group_display);
    }
}

function refreshGroups() {
    group_manager.innerHTML = ``;
    group_list.innerHTML = ``;
    let oReq = new XMLHttpRequest();
    oReq.addEventListener('load', updateGroupsList);
    oReq.open('GET', '/api/group');
    oReq.send();
}

function addGroup() {
    //FIXME: Need to generate a form that can submit a new
    // group via the JSON API.
    let group_input = document.createElement('group-input');
    group_manager.innerHTML = ``;
    group_list.innerHTML = ``;
    group_manager.appendChild(group_input);
    group_list.innerHTML = ``;
    console.log("addGroup() called");
}

function editGroup() {
    //FIXME: Need to generate a form that can submit a new
    // group via the JSON API.
    let group_input = document.createElement('group-input');
    group_manager.appendChild(group_input);
    group_list.innerHTML = ``;
    console.log("editGroup() called");
}

group_add_button.addEventListener('click', addGroup);
group_refresh_button.addEventListener('click', refreshGroups);

refreshGroups();
</script>
</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2022 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>
