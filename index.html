<!DOCTYPE html>
<html>
<head>
    <title>COLD (Controlled Object List Daemon (Concept))</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://caltechlibrary.github.io/css/site.css">
</head>
<body>
<header>
<a href="http://library.caltech.edu" title="link to Caltech Library Homepage"><img src="https://caltechlibrary.github.io/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
    <li><a href="/">Home</a></li>
    <li><a href="index.html">README</a></li>
    <li><a href="LICENSE">LICENSE</a></li>
    <li><a href="install.html">INSTALL</a></li>
    <li><a href="user-manual.html">User Manual</a></li>
    <li><a href="about.html">About</a></li>
    <li><a href="https://github.com/caltechlibrary/cold">GitHub</a></li>
</ul>
</nav>

<section>
<h1 id="cold---controlled-object-list-daemon">cold - (c)ontrolled
(o)bject (l)ist (d)aemon</h1>
<p>This repository implements a service to maintain a controlled list of
objects and vocabularies used at Caltech Library for people,
organizations and funders. It is built from data modeled in PostgreSQL
and managed via a series of microservices that combine to form a human
user interface implemented in the web browser.</p>
<h1 id="requirements">Requirements</h1>
<ul>
<li>MySQL &gt;= 8</li>
<li>PostgreSQL &gt;= 15</li>
<li>PostgREST &gt;= 11</li>
<li>Pandoc &gt;= 3</li>
<li>To build the UI and compile the <strong>cold</strong> daemon
<ul>
<li>GNU Make</li>
<li><a href="https://pandoc.org">Pandoc</a> (to build UI)</li>
<li>A text editor (e.g. Zed, VSCode, micro, nano, vi, emacs …)</li>
</ul></li>
<li>A front end web server with SSO or Basic Auth support</li>
<li>A web browser with JavaScript support</li>
</ul>
<h2 id="recommended">Recommended</h2>
<p>Most package managers running on various flavors of Unix (e.g. macOS,
Linux) do not provide Pandoc 3 or PostgREST. There is a good chance you
will need to build this from source if they are not already available on
the system where <strong>cold</strong> will run.</p>
<ul>
<li>Install Haskell via <a
href="https://www.haskell.org/ghcup/">ghcup</a>
<ul>
<li>See <a
href="https://pandoc.org/installing.html#quick-cabal-method">Pandoc</a>
to for instructions to compile Pandoc 3</li>
<li>See
[https://postgrest.org/en/stable/install.html#building-from-source]) for
instructions to compile PostgREST 10</li>
</ul></li>
</ul>
<h2 id="overview">Overview</h2>
<p>Caltech Library maintains a list of people, groups and funders and
their related pids. This started being managed in Google Sheets, then in
CSV files but the number of objects in envoled has increased and it make
sense to provide a more robust implementation allowing for easier
curation of the list. The objects are relatively flat. Here’s an example
JSON object representing R. S. Doiel showing the internal identifier
named “cl_people_id”, name object, email, orcid and Caltech affiliation
is shown both via a boolean field and a ROR.</p>
<pre><code>{
    &quot;cl_people_id&quot;: &quot;Doiel-R-S&quot;,
    &quot;family_name&quot;: &quot;Doiel&quot;,
    &quot;given_name&quot;: &quot;Robert&quot;,
    &quot;orcid&quot;: &quot;0000-0003-0900-6903&quot;,
    &quot;authors_id&quot;: &quot;Doiel-R-S&quot;,
    &quot;directory_id&quot;: &quot;rsdoiel&quot;,
    &quot;caltech&quot;: true,
    &quot;status&quot;: &quot;Active&quot;,
    &quot;directory_person_type&quot;: &quot;Staff&quot;,
    &quot;division&quot;: &quot;Libraries Group&quot;,
    &quot;updated&quot;: &quot;2022-03-09&quot;
    &quot;ror&quot;: &quot;https://ror.org/05dxps055&quot;
} </code></pre>
<p>A group object for Caltech Library is also flat.</p>
<pre><code>{
    &quot;cl_group_id&quot;: &quot;Caltech-Library&quot;,
    &quot;name&quot;: &quot;Caltech Library&quot;,
    &quot;alternative&quot;: &quot;Caltech Library System; Library System Papers and Publications&quot;,
    &quot;updated&quot;: &quot;2020-03-26 00:00:00&quot;
}</code></pre>
<p>Some objects may have more attributes others less. A simple table
schema containing a row id, an internal identifier (e.g. cl_people_id,
cl_group_id), a “field” and a “value” can be used to represent all the
types of fields associated with a given object. A separate table can be
used for person, group and finder with the individual objects stored as
a JSON type. This is well suited to a data collection that has sparse
consistency (e.g. one person might have an ORCID but not a research id,
the next might have a viaf or wikidata id but not a ORCID).</p>
<pre><code>CREATE TABLE people (cl_people_id VARCHAR(255) PRIMARY KEY, object JSON);
CREATE TABLE local_group (cl_group_id VARCHAR(255) PRIMARY KEY, object JSON);
&lt;!-- CREATE TABLE funder (cl_funder_id VARCHAR(255) PRIMARY KEY, object JSON); --&gt;</code></pre>
<h2 id="approach">Approach</h2>
<p><strong>cold</strong> models it data in PostgreSQL which is
responsible for defining views and procedures to implement end points in
a JSON API provide by PostgREST. The UI for <strong>cold</strong> is
implemented in the web browser via static HTML, CSS and JavaScript.
Since displaying data structures can be burdensome directly with
JavaScript interacting with the DOM Pandoc running in server mode is
available to compose the framents from the JSON API service. JavaScript
running in the browser is then resposible for fetching the JSON
represention, passing the results along with template info too the
Pandoc server before injecting them into the browser DOM.</p>
<h2 id="end-points">End Points</h2>
<p>JSON API is provided by PostgREST. The following end point
descriptions support the GET method.</p>
<dl>
<dt><code>/</code></dt>
<dd>
A description of PostgREST information
</dd>
<dt><code>/cold/version</code></dt>
<dd>
Returns the version number of the service
</dd>
<dt><code>/cold/people</code></dt>
<dd>
Returns a list of “cl_people_id” managed by <em>cold</em>
</dd>
<dt><code>/cold/people/{CL_PEOPLE_ID}</code></dt>
<dd>
For a GET returns a people object, a PUT will create the people object,
POST will replace the people object and DELETE will remove the people
object
</dd>
<dt><code>/cold/group</code></dt>
<dd>
Returns a list of “cl_group_id” managed by <em>cold</em>
</dd>
<dt><code>/cold/group/{CL_GROUP_ID}</code></dt>
<dd>
For a GET returns a group object, a PUT will create the group object,
POST will replace the group object and DELETE will remove the group
object
</dd>
</dl>
<h2 id="crosswalks">Crosswalks</h2>
<p>A cross walk lets you put in a collection name (e.g. people, group),
a field name and a value and it returns a list of matching records.</p>
<dl>
<dt><code>/cold/crosswalk/people/{IDENTIFIER_NAME}/{IDENTIFIER_VALUE}</code></dt>
<dd>
Returns a list of “cl_people_id” assocated with that identifier
</dd>
<dt><code>/cold/crosswalk/group/{IDENTIFIER_NAME}/{IDENTIFIER_VALUE}</code></dt>
<dd>
Returns a list of “cl_group__id” assocated with that identifier
</dd>
</dl>
<p><em>cold</em> takes a REST approach to updates for managed objects.
PUT will create a new object, POST will update it, GET will retrieve it
and DELETE will remove it.</p>
<h2 id="vocabularies">Vocabularies</h2>
<p><em>cold</em> also supports end points for stable vocabularies
mapping an indentifier to a normalized name. These are set at compile
time because they are so slow changing.</p>
<dl>
<dt><code>/cold/subject</code></dt>
<dd>
Returns a list of all the subject ids (codes)
</dd>
<dt><code>/cold/subject/{SUBJECT_ID}</code></dt>
<dd>
Returns the normalized text string for that subject id
</dd>
<dt><code>/cold/issn</code></dt>
<dd>
Returns a list of issn that are mapped to a publisher name
</dd>
<dt><code>/cold/issn/{ISSN}</code></dt>
<dd>
Returns the normalized publisher name for that ISSN
</dd>
<dt><code>/cold/doi-prefix</code></dt>
<dd>
Returns a list of DOI prefixes that map to a normalize name
</dd>
<dt><code>/cold/doi-prefix/{DOI_PREFIX}</code></dt>
<dd>
Returns the normalized publisher name for that DOI prefix
</dd>
</dl>
<h1 id="manage-interface">Manage interface</h1>
<p>The management inteface is avialable at
<code>/app/dashboard.html</code> path. This provides a dashboard which
then interacts with the JSON side of the service to update content. The
manage interface is built from Web Components and requires JavaScript to
be enabled in the browser.</p>
<h2 id="widgets">Widgets</h2>
<p>Widgets provide the user interface for humans to manage and view the
objects. While <strong>cold</strong> can directly host these it is
equally possible to integrate the static components into another system,
web service or web site. They are only static web assets. The public
facing web service needs to control access to <strong>cold</strong> and
the static content does not contain anything that is priviliged. The
Widgets can be loaded indepentently in the page using the following end
points.</p>
<dl>
<dt><code>/widgets/person.js</code></dt>
<dd>
This JavaScript file provides a display and input set of web components
for our Person Object. Markup example
<code>&lt;person-display honorific="Mr." given="R. S." family="Doiel" lineage="" orcid="0000-0003-0900-6903"&gt;&lt;/person-display&gt;</code>
and
<code>&lt;person-input honorific="Mr." given="R. S." family="Doiel" lineage="" orcid="0000-0003-0900-6903"&gt;&lt;/person-input&gt;</code>
</dd>
<dt><code>/widgets/group.js</code></dt>
<dd>
This JavaScript file provides a display and input set of web components
for our Markup example
<code>&lt;group-display name="GALCIT" ror=""&gt;&lt;/group-display&gt;</code>
and
<code>&lt;group-input  name="GALCIT" ror="" label=""&gt;&lt;/group-input&gt;</code>
</dd>
<dt><code>/widgets/vocabulary.js</code></dt>
<dd>
This JavaScript file provides a identifier/name web component suitable
for displaying subjects, issn/publisher info and doi-prefix/publisher
info.
</dd>
</dl>
</section>

<footer>
<span>&copy; 2022 <a href="https://www.library.caltech.edu/copyright">Caltech Library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
</footer>
</body>
</html>
